<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¢æˆ·ç®¡ç† - å·¥ä¸šåœ°äº§SCRM</title>
    <link rel="stylesheet" href="../../assets/css/global.css">
    <link rel="stylesheet" href="../../assets/css/components.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .customer-card {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
        }
        
        .customer-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .customer-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .customer-info {
            flex: 1;
            min-width: 0;
        }
        
        .customer-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-xs);
            margin: var(--spacing-sm) 0;
        }
        
        .detail-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .detail-item i {
            width: 14px;
            font-size: 12px;
        }
        
        .customer-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: var(--spacing-sm) 0;
        }
        
        .customer-level {
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .level-a {
            background: var(--error-color);
            color: white;
        }
        
        .level-b {
            background: var(--warning-color);
            color: white;
        }
        
        .level-c {
            background: var(--info-color);
            color: white;
        }
        
        @media (max-width: 768px) {
            .customer-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="page">
            <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
            <header class="navbar">
                <button class="navbar-back" onclick="Navigation.back()">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="navbar-title">å®¢æˆ·ç®¡ç†</div>
                <div class="navbar-actions">
                    <button class="navbar-action" onclick="showSearchModal()">
                        <i class="fas fa-search"></i>
                    </button>
                    <button class="navbar-action" onclick="showFilterModal()">
                        <i class="fas fa-filter"></i>
                    </button>
                </div>
            </header>

            <!-- æœç´¢æ  -->
            <div class="search-bar">
                <input type="text" class="search-input" placeholder="ğŸ” è¾“å…¥å®¢æˆ·åç§°..." id="searchInput" onInput="handleSearch(this.value)">
                <button class="search-filter" onclick="showFilterModal()">
                    ç­›é€‰ <i class="fas fa-cog"></i>
                </button>
            </div>

            <!-- ç­›é€‰æ ‡ç­¾æ  -->
            <div class="filter-tabs">
                <button class="filter-tab active" data-status="all" onclick="filterByStatus('all')">å…¨éƒ¨</button>
                <button class="filter-tab" data-status="intent" onclick="filterByStatus('intent')">æ„å‘</button>
                <button class="filter-tab" data-status="viewing" onclick="filterByStatus('viewing')">å¸¦çœ‹</button>
                <button class="filter-tab" data-status="deal" onclick="filterByStatus('deal')">æˆäº¤</button>
                <button class="filter-tab" data-status="follow" onclick="filterByStatus('follow')">è·Ÿè¿›ä¸­</button>
            </div>

            <!-- é¡µé¢å†…å®¹ -->
            <main class="page-content">
                <!-- å®¢æˆ·ç»Ÿè®¡ -->
                <div class="stats-cards" style="grid-template-columns: repeat(4, 1fr); margin-bottom: 16px;">
                    <div class="stats-card">
                        <div class="number" id="totalCustomers">0</div>
                        <div class="label">æ€»å®¢æˆ·</div>
                    </div>
                    <div class="stats-card">
                        <div class="number" id="intentCustomers">0</div>
                        <div class="label">æ„å‘</div>
                    </div>
                    <div class="stats-card">
                        <div class="number" id="viewingCustomers">0</div>
                        <div class="label">å¸¦çœ‹</div>
                    </div>
                    <div class="stats-card">
                        <div class="number" id="dealCustomers">0</div>
                        <div class="label">æˆäº¤</div>
                    </div>
                </div>

                <!-- å®¢æˆ·åˆ—è¡¨ -->
                <div id="customerList" class="customer-list">
                    <!-- å®¢æˆ·å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>

                <!-- ç©ºçŠ¶æ€ -->
                <div id="emptyState" class="empty-state" style="display: none;">
                    <div class="icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="title">æš‚æ— å®¢æˆ·æ•°æ®</div>
                    <div class="description">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ ç¬¬ä¸€ä¸ªå®¢æˆ·</div>
                    <button class="btn btn-primary" onclick="Navigation.goto('add.html')">
                        <i class="fas fa-plus"></i>
                        æ·»åŠ å®¢æˆ·
                    </button>
                </div>

                <!-- åŠ è½½çŠ¶æ€ -->
                <div id="loadingState" class="text-center p-4">
                    <div class="spinner" style="margin: 0 auto 16px;"></div>
                    <div class="text-secondary">åŠ è½½å®¢æˆ·æ•°æ®ä¸­...</div>
                </div>
            </main>

            <!-- åº•éƒ¨å¯¼èˆªæ  -->
            <nav class="tabbar">
                <a href="../index.html" class="tabbar-item">
                    <div class="icon">
                        <i class="fas fa-home"></i>
                    </div>
                    é¦–é¡µ
                </a>
                <a href="index.html" class="tabbar-item active">
                    <div class="icon">
                        <i class="fas fa-users"></i>
                    </div>
                    å®¢æˆ·
                    <span class="badge" id="customerBadge">0</span>
                </a>
                <a href="../property/index.html" class="tabbar-item">
                    <div class="icon">
                        <i class="fas fa-building"></i>
                    </div>
                    æˆ¿æº
                </a>
                <a href="../promotion/index.html" class="tabbar-item">
                    <div class="icon">
                        <i class="fas fa-share-alt"></i>
                    </div>
                    æ¨å¹¿
                </a>
                <a href="../profile/index.html" class="tabbar-item">
                    <div class="icon">
                        <i class="fas fa-user"></i>
                    </div>
                    æˆ‘çš„
                </a>
            </nav>
        </div>
    </div>

    <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
    <button class="fab" onclick="Navigation.goto('add.html')">
        <i class="fas fa-plus"></i>
    </button>

    <!-- æœç´¢æ¨¡æ€æ¡† -->
    <div id="searchModal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">æœç´¢å®¢æˆ·</h3>
                <button class="modal-close" onclick="hideSearchModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">å®¢æˆ·åç§°</label>
                    <input type="text" class="form-control" placeholder="è¾“å…¥å…¬å¸åç§°æˆ–è”ç³»äºº" id="modalSearchInput">
                </div>
                <div class="form-group">
                    <label class="form-label">è”ç³»ç”µè¯</label>
                    <input type="text" class="form-control" placeholder="è¾“å…¥è”ç³»ç”µè¯" id="phoneSearchInput">
                </div>
                <div class="form-group">
                    <label class="form-label">æ‰€å±è¡Œä¸š</label>
                    <select class="form-control" id="industryFilter">
                        <option value="">å…¨éƒ¨è¡Œä¸š</option>
                        <option value="ç”µå­åˆ¶é€ ">ç”µå­åˆ¶é€ </option>
                        <option value="æœºæ¢°åˆ¶é€ ">æœºæ¢°åˆ¶é€ </option>
                        <option value="åŒ–å·¥">åŒ–å·¥</option>
                        <option value="çººç»‡">çººç»‡</option>
                        <option value="é£Ÿå“">é£Ÿå“</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="resetSearch()">é‡ç½®</button>
                <button class="btn btn-primary" onclick="performSearch()">æœç´¢</button>
            </div>
        </div>
    </div>

    <!-- ç­›é€‰æ¨¡æ€æ¡† -->
    <div id="filterModal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">ç­›é€‰æ¡ä»¶</h3>
                <button class="modal-close" onclick="hideFilterModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">å®¢æˆ·çŠ¶æ€</label>
                    <div class="filter-tabs" style="flex-wrap: wrap;">
                        <button class="filter-tab active" data-status="all">å…¨éƒ¨</button>
                        <button class="filter-tab" data-status="åˆæ­¥æ„å‘">åˆæ­¥æ„å‘</button>
                        <button class="filter-tab" data-status="å¸¦çœ‹ä¸­">å¸¦çœ‹ä¸­</button>
                        <button class="filter-tab" data-status="å·²æˆäº¤">å·²æˆäº¤</button>
                        <button class="filter-tab" data-status="è·Ÿè¿›ä¸­">è·Ÿè¿›ä¸­</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">é¢„ç®—èŒƒå›´</label>
                    <div class="grid-2">
                        <input type="number" class="form-control" placeholder="æœ€ä½é¢„ç®—" id="minBudget">
                        <input type="number" class="form-control" placeholder="æœ€é«˜é¢„ç®—" id="maxBudget">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">é¢ç§¯éœ€æ±‚</label>
                    <div class="grid-2">
                        <input type="number" class="form-control" placeholder="æœ€å°é¢ç§¯" id="minArea">
                        <input type="number" class="form-control" placeholder="æœ€å¤§é¢ç§¯" id="maxArea">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">æœ€åè·Ÿè¿›æ—¶é—´</label>
                    <select class="form-control" id="lastContactFilter">
                        <option value="">å…¨éƒ¨</option>
                        <option value="today">ä»Šå¤©</option>
                        <option value="week">æœ¬å‘¨</option>
                        <option value="month">æœ¬æœˆ</option>
                        <option value="overdue">è¶…æœŸæœªè·Ÿè¿›</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="resetFilter()">é‡ç½®</button>
                <button class="btn btn-primary" onclick="applyFilter()">åº”ç”¨ç­›é€‰</button>
            </div>
        </div>
    </div>

    <script src="../../assets/js/common.js"></script>
    <script>
// å®¢æˆ·æ•°æ®
let customerData = [];
let filteredCustomers = [];
let currentFilter = 'all';
let searchQuery = '';

// é¡µé¢åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    loadCustomerData();
});

// åŠ è½½å®¢æˆ·æ•°æ®
async function loadCustomerData() {
    try {
        const loadingState = document.getElementById('loadingState');
        const customerList = document.getElementById('customerList');
        const emptyState = document.getElementById('emptyState');
        
        if (loadingState) loadingState.style.display = 'block';
        if (customerList) customerList.style.display = 'none';
        if (emptyState) emptyState.style.display = 'none';
        
        // æ¨¡æ‹Ÿå®¢æˆ·æ•°æ®
        const mockData = {
            success: true,
            data: [
                {
                    id: 1,
                    companyName: 'ä¸Šæµ·XXåˆ¶é€ æœ‰é™å…¬å¸',
                    contactName: 'å¼ ç»ç†',
                    phone: '138-0000-1234',
                    industry: 'åˆ¶é€ ä¸š',
                    status: 'æ„å‘å®¢æˆ·',
                    level: 'A',
                    lastContact: '2024-09-01',
                    budget: '100-200ä¸‡',
                    area: '2000-5000ã¡',
                    avatar: 'https://via.placeholder.com/50x50?text=å¼ '
                },
                {
                    id: 2,
                    companyName: 'æ·±åœ³ç§‘æŠ€åˆ›æ–°ä¼ä¸š',
                    contactName: 'ææ€»',
                    phone: '139-1111-2222',
                    industry: 'ç”µå­ä¿¡æ¯',
                    status: 'å¸¦çœ‹ä¸­',
                    level: 'A',
                    lastContact: '2024-09-02',
                    budget: '200-500ä¸‡',
                    area: '3000-8000ã¡',
                    avatar: 'https://via.placeholder.com/50x50?text=æ'
                },
                {
                    id: 3,
                    companyName: 'å¹¿å·ç”Ÿç‰©åŒ»è¯å…¬å¸',
                    contactName: 'ç‹è‘£',
                    phone: '137-2222-3333',
                    industry: 'ç”Ÿç‰©åŒ»è¯',
                    status: 'å·²æˆäº¤',
                    level: 'A',
                    lastContact: '2024-08-30',
                    budget: '500ä¸‡ä»¥ä¸Š',
                    area: '5000-10000ã¡',
                    avatar: 'https://via.placeholder.com/50x50?text=ç‹'
                },
                {
                    id: 4,
                    companyName: 'ä¸œèæ™ºèƒ½è£…å¤‡æœ‰é™å…¬å¸',
                    contactName: 'é™ˆç»ç†',
                    phone: '136-3333-4444',
                    industry: 'æ™ºèƒ½åˆ¶é€ ',
                    status: 'è·Ÿè¿›ä¸­',
                    level: 'B',
                    lastContact: '2024-08-28',
                    budget: '50-100ä¸‡',
                    area: '1000-3000ã¡',
                    avatar: 'https://via.placeholder.com/50x50?text=é™ˆ'
                },
                {
                    id: 5,
                    companyName: 'ä½›å±±æ–°ææ–™ç ”å‘ä¸­å¿ƒ',
                    contactName: 'åˆ˜ä¸»ä»»',
                    phone: '135-4444-5555',
                    industry: 'æ–°ææ–™',
                    status: 'åˆæ­¥æ„å‘',
                    level: 'B',
                    lastContact: '2024-08-25',
                    budget: '100-200ä¸‡',
                    area: '2000-4000ã¡',
                    avatar: 'https://via.placeholder.com/50x50?text=åˆ˜'
                }
            ]
        };
        
        if (mockData.success) {
            customerData = mockData.data;
            filteredCustomers = [...customerData];
            
            updateCustomerStats();
            renderCustomerList();
            
            if (loadingState) loadingState.style.display = 'none';
            if (customerData.length > 0) {
                if (customerList) customerList.style.display = 'block';
            } else {
                if (emptyState) emptyState.style.display = 'block';
            }
        }
    } catch (error) {
        console.error('åŠ è½½å®¢æˆ·æ•°æ®å¤±è´¥:', error);
        Utils.showToast('æ•°æ®åŠ è½½å¤±è´¥', 'error');
    }
}

// æ›´æ–°å®¢æˆ·ç»Ÿè®¡
function updateCustomerStats() {
    const total = customerData.length;
    const intent = customerData.filter(c => c.status === 'æ„å‘å®¢æˆ·').length;
    const viewing = customerData.filter(c => c.status === 'å¸¦çœ‹ä¸­').length;
    const deal = customerData.filter(c => c.status === 'å·²æˆäº¤').length;
    
    document.getElementById('totalCustomers').textContent = total;
    document.getElementById('intentCustomers').textContent = intent;
    document.getElementById('viewingCustomers').textContent = viewing;
    document.getElementById('dealCustomers').textContent = deal;
    
    // æ›´æ–°å¾½ç« 
    const badge = document.getElementById('customerBadge');
    if (badge) badge.textContent = total;
}

// æ¸²æŸ“å®¢æˆ·åˆ—è¡¨
function renderCustomerList() {
    const container = document.getElementById('customerList');
    if (!container) return;
    
    if (filteredCustomers.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <div class="icon"><i class="fas fa-search"></i></div>
                <div class="title">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å®¢æˆ·</div>
                <div class="description">å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶æˆ–æœç´¢å…³é”®è¯</div>
            </div>
        `;
        return;
    }
    
    container.innerHTML = filteredCustomers.map(customer => createCustomerCard(customer)).join('');
}

// åˆ›å»ºå®¢æˆ·å¡ç‰‡
function createCustomerCard(customer) {
    const statusClass = getStatusClass(customer.status);
    
    return `
        <div class="list-item customer-card" data-customer-id="${customer.id}">
            <div class="customer-avatar">
                <img src="${customer.avatar}" 
                     alt="${customer.contactName}" 
                     data-responsive 
                     data-base-url="${customer.avatar.split('?')[0]}"
                     data-sizes='{"xs":{"width":50,"height":50},"sm":{"width":60,"height":60},"md":{"width":80,"height":80}}'
                     loading="lazy"
                     data-lazy-processed="false"
                     onerror="this.src='https://via.placeholder.com/50x50?text=${customer.contactName.charAt(0)}'">
            </div>
            
            <div class="customer-info">
                <div class="list-item-title">${customer.companyName}</div>
                <div class="list-item-subtitle">
                    <i class="fas fa-user mr-1"></i>
                    ${customer.contactName} | ${customer.phone}
                </div>
                
                <div class="customer-details">
                    <div class="detail-item">
                        <i class="fas fa-industry text-primary"></i>
                        ${customer.industry}
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-money-bill-wave text-success"></i>
                        ${customer.budget}
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-ruler-combined text-info"></i>
                        ${customer.area}
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-calendar text-warning"></i>
                        ${customer.lastContact}
                    </div>
                </div>
                
                <div class="customer-meta">
                    <div class="customer-level level-${customer.level.toLowerCase()}">
                        ${customer.level}çº§å®¢æˆ·
                    </div>
                    <div class="status-badge ${statusClass}">
                        ${customer.status}
                    </div>
                </div>
                
                <div class="list-item-actions">
                    <a href="detail.html?id=${customer.id}" class="list-item-action primary">
                        <i class="fas fa-eye"></i>
                        è¯¦æƒ…
                    </a>
                    <a href="follow.html?id=${customer.id}" class="list-item-action success">
                        <i class="fas fa-plus"></i>
                        è·Ÿè¿›
                    </a>
                    <a href="edit.html?id=${customer.id}" class="list-item-action">
                        <i class="fas fa-edit"></i>
                        ç¼–è¾‘
                    </a>
                </div>
            </div>
        </div>
    `;
}

// è·å–çŠ¶æ€æ ·å¼ç±»
function getStatusClass(status) {
    const statusMap = {
        'æ„å‘å®¢æˆ·': 'warning',
        'å¸¦çœ‹ä¸­': 'info',
        'å·²æˆäº¤': 'success',
        'è·Ÿè¿›ä¸­': 'primary',
        'åˆæ­¥æ„å‘': 'secondary'
    };
    return statusMap[status] || 'secondary';
}

// æŒ‰çŠ¶æ€ç­›é€‰
function filterByStatus(status) {
    currentFilter = status;
    
    const filterTabs = document.querySelectorAll('.filter-tab[data-status]');
    filterTabs.forEach(tab => {
        tab.classList.remove('active');
        if (tab.dataset.status === status) {
            tab.classList.add('active');
        }
    });
    
    applyFilters();
}

// æœç´¢å¤„ç†
function handleSearch(query) {
    searchQuery = query.toLowerCase();
    applyFilters();
}

// åº”ç”¨ç­›é€‰æ¡ä»¶
function applyFilters() {
    filteredCustomers = customerData.filter(customer => {
        const statusMatch = currentFilter === 'all' || customer.status === currentFilter;
        
        const searchMatch = !searchQuery || 
            customer.companyName.toLowerCase().includes(searchQuery) ||
            customer.contactName.toLowerCase().includes(searchQuery) ||
            customer.phone.toLowerCase().includes(searchQuery);
        
        return statusMatch && searchMatch;
    });
    
    renderCustomerList();
}

// æ˜¾ç¤ºæœç´¢æ¨¡æ€æ¡†
function showSearchModal() {
    document.getElementById('searchModal').style.display = 'flex';
}

// éšè—æœç´¢æ¨¡æ€æ¡†
function hideSearchModal() {
    document.getElementById('searchModal').style.display = 'none';
}

// æ˜¾ç¤ºç­›é€‰æ¨¡æ€æ¡†  
function showFilterModal() {
    document.getElementById('filterModal').style.display = 'flex';
}

// éšè—ç­›é€‰æ¨¡æ€æ¡†
function hideFilterModal() {
    document.getElementById('filterModal').style.display = 'none';
}

// æ‰§è¡Œæœç´¢
function performSearch() {
    const searchInput = document.getElementById('modalSearchInput').value;
    const phoneInput = document.getElementById('phoneSearchInput').value;
    const industry = document.getElementById('industryFilter').value;
    
    // ç»„åˆæœç´¢æ¡ä»¶
    let query = '';
    if (searchInput) query += searchInput + ' ';
    if (phoneInput) query += phoneInput + ' ';
    if (industry) query += industry + ' ';
    
    handleSearch(query.trim());
    hideSearchModal();
}

// é‡ç½®æœç´¢
function resetSearch() {
    document.getElementById('modalSearchInput').value = '';
    document.getElementById('phoneSearchInput').value = '';
    document.getElementById('industryFilter').value = '';
    handleSearch('');
}

// åº”ç”¨ç­›é€‰
function applyFilter() {
    // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤æ‚çš„ç­›é€‰é€»è¾‘
    hideFilterModal();
    Utils.showToast('ç­›é€‰æ¡ä»¶å·²åº”ç”¨', 'success');
}

// é‡ç½®ç­›é€‰
function resetFilter() {
    // é‡ç½®æ‰€æœ‰ç­›é€‰æ¡ä»¶
    currentFilter = 'all';
    searchQuery = '';
    
    // é‡ç½®UI
    document.querySelectorAll('.filter-tab[data-status]').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelector('.filter-tab[data-status="all"]').classList.add('active');
    
    applyFilters();
}

// å¯¼å‡ºå‡½æ•°ä¾›å…¨å±€ä½¿ç”¨
window.filterByStatus = filterByStatus;
window.handleSearch = handleSearch;
window.showSearchModal = showSearchModal;
window.hideSearchModal = hideSearchModal;
window.showFilterModal = showFilterModal;
window.hideFilterModal = hideFilterModal;
window.performSearch = performSearch;
window.resetSearch = resetSearch;
window.applyFilter = applyFilter;
window.resetFilter = resetFilter;
    </script>
</body>
</html>