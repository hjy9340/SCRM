<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>房源管理 - 工业地产SCRM</title>
    <link rel="stylesheet" href="../../assets/css/global.css">
    <link rel="stylesheet" href="../../assets/css/components.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="page">
            <!-- 顶部导航栏 -->
            <header class="navbar">
                <button class="navbar-back" onclick="Navigation.back()">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="navbar-title">房源管理</div>
                <div class="navbar-actions">
                    <button class="navbar-action" onclick="openImageGenerator()">
                        <i class="fas fa-magic"></i>
                    </button>
                    <button class="navbar-action" onclick="showSearchModal()">
                        <i class="fas fa-search"></i>
                    </button>
                    <button class="navbar-action" onclick="showFilterModal()">
                        <i class="fas fa-filter"></i>
                    </button>
                </div>
            </header>

            <!-- 搜索栏 -->
            <div class="search-bar">
                <input type="text" class="search-input" placeholder="🔍 输入房源关键词..." id="searchInput" onInput="handleSearch(this.value)">
                <button class="search-filter" onclick="showFilterModal()">
                    筛选 <i class="fas fa-cog"></i>
                </button>
            </div>

            <!-- 筛选标签栏 -->
            <div class="filter-tabs">
                <button class="filter-tab active" data-type="all" onclick="filterByType('all')">全部</button>
                <button class="filter-tab" data-type="rent" onclick="filterByType('rent')">出租</button>
                <button class="filter-tab" data-type="sale" onclick="filterByType('sale')">出售</button>
                <button class="filter-tab" data-type="sold" onclick="filterByType('sold')">已成交</button>
            </div>

            <!-- 页面内容 -->
            <main class="page-content">
                <!-- 房源统计 -->
                <div class="stats-cards" style="grid-template-columns: repeat(4, 1fr); margin-bottom: 16px;">
                    <div class="stats-card">
                        <div class="number" id="totalProperties">0</div>
                        <div class="label">总房源</div>
                    </div>
                    <div class="stats-card">
                        <div class="number" id="rentProperties">0</div>
                        <div class="label">出租</div>
                    </div>
                    <div class="stats-card">
                        <div class="number" id="saleProperties">0</div>
                        <div class="label">出售</div>
                    </div>
                    <div class="stats-card">
                        <div class="number" id="soldProperties">0</div>
                        <div class="label">已成交</div>
                    </div>
                </div>

                <!-- 房源列表 -->
                <div id="propertyList" class="property-list">
                    <!-- 房源卡片将通过JavaScript动态生成 -->
                </div>

                <!-- 空状态 -->
                <div id="emptyState" class="empty-state" style="display: none;">
                    <div class="icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="title">暂无房源数据</div>
                    <div class="description">点击下方按钮发布第一个房源</div>
                    <button class="btn btn-primary" onclick="Navigation.goto('add.html')">
                        <i class="fas fa-plus"></i>
                        发布房源
                    </button>
                </div>

                <!-- 加载状态 -->
                <div id="loadingState" class="text-center p-4">
                    <div class="spinner" style="margin: 0 auto 16px;"></div>
                    <div class="text-secondary">加载房源数据中...</div>
                </div>
            </main>

            <!-- 底部导航栏 -->
            <nav class="tabbar">
                <a href="../index.html" class="tabbar-item">
                    <div class="icon">
                        <i class="fas fa-home"></i>
                    </div>
                    首页
                </a>
                <a href="../customer/index.html" class="tabbar-item">
                    <div class="icon">
                        <i class="fas fa-users"></i>
                    </div>
                    客户
                </a>
                <a href="index.html" class="tabbar-item active">
                    <div class="icon">
                        <i class="fas fa-building"></i>
                    </div>
                    房源
                </a>
                <a href="../promotion/index.html" class="tabbar-item">
                    <div class="icon">
                        <i class="fas fa-share-alt"></i>
                    </div>
                    推广
                </a>
                <a href="../profile/index.html" class="tabbar-item">
                    <div class="icon">
                        <i class="fas fa-user"></i>
                    </div>
                    我的
                </a>
            </nav>
        </div>
    </div>

    <!-- 浮动操作按钮 -->
    <div class="fab-group">
        <button class="fab fab-secondary" onclick="openImageGenerator()" title="AI图片生成">
            <i class="fas fa-magic"></i>
        </button>
        <button class="fab" onclick="Navigation.goto('add.html')" title="发布房源">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <script src="../../assets/js/common.js"></script>
    <script>
// 房源数据
let propertyData = [];
let filteredProperties = [];
let currentFilter = 'all';

// 加载房源数据
async function loadPropertyData() {
    try {
        const loadingState = document.getElementById('loadingState');
        const propertyList = document.getElementById('propertyList');
        const emptyState = document.getElementById('emptyState');
        
        if (loadingState) loadingState.style.display = 'block';
        if (propertyList) propertyList.style.display = 'none';
        if (emptyState) emptyState.style.display = 'none';
        
        // 使用模拟数据
        const mockData = {
            success: true,
            data: [
                {
                    id: 1,
                    title: '深圳宝安区现代工业园区',
                    location: '深圳市宝安区石岩街道',
                    type: '出租',
                    status: '可租',
                    price: 80,
                    area: 3000,
                    height: 8,
                    load: 800,
                    views: 125,
                    image: 'https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=400&h=300&fit=crop'
                },
                {
                    id: 2,
                    title: '广州天河科技园厂房',
                    location: '广州市天河区科学城',
                    type: '出租',
                    status: '可租',
                    price: 75,
                    area: 2500,
                    height: 6,
                    load: 600,
                    views: 98,
                    image: 'https://images.unsplash.com/photo-1565043666747-69f6646db940?w=400&h=300&fit=crop'
                },
                {
                    id: 3,
                    title: '东莞松山湖高新产业园',
                    location: '东莞市松山湖园区',
                    type: '出售',
                    status: '在售',
                    price: 2800,
                    area: 5000,
                    height: 10,
                    load: 1000,
                    views: 156,
                    image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop'
                },
                {
                    id: 4,
                    title: '佛山南海智能制造基地',
                    location: '佛山市南海区桂城街道',
                    type: '出租',
                    status: '可租',
                    price: 65,
                    area: 4200,
                    height: 9,
                    load: 900,
                    views: 87,
                    image: 'https://images.unsplash.com/photo-1541888946425-d81bb19240f5?w=400&h=300&fit=crop'
                },
                {
                    id: 5,
                    title: '惠州大亚湾石化园区',
                    location: '惠州市大亚湾开发区',
                    type: '出租',
                    status: '可租',
                    price: 55,
                    area: 6000,
                    height: 12,
                    load: 1200,
                    views: 142,
                    image: 'https://images.unsplash.com/photo-1504917595217-d4dc5ebe6122?w=400&h=300&fit=crop'
                },
                {
                    id: 6,
                    title: '中山火炬开发区厂房',
                    location: '中山市火炬开发区',
                    type: '出售',
                    status: '在售',
                    price: 1800,
                    area: 3500,
                    height: 7,
                    load: 700,
                    views: 73,
                    image: 'https://images.unsplash.com/photo-1497366216548-37526070297c?w=400&h=300&fit=crop'
                },
                {
                    id: 7,
                    title: '珠海横琴自贸区产业园',
                    location: '珠海市横琴新区',
                    type: '出租',
                    status: '已成交',
                    price: 120,
                    area: 2800,
                    height: 8,
                    load: 800,
                    views: 203,
                    image: 'https://images.unsplash.com/photo-1497366811353-6870744d04b2?w=400&h=300&fit=crop'
                },
                {
                    id: 8,
                    title: '江门蓬江区智造园',
                    location: '江门市蓬江区',
                    type: '出租',
                    status: '可租',
                    price: 45,
                    area: 4800,
                    height: 6,
                    load: 600,
                    views: 64,
                    image: 'https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=400&h=300&fit=crop'
                }
            ]
        };
        
        if (mockData.success) {
            propertyData = mockData.data;
            filteredProperties = [...propertyData];
            
            updatePropertyStats();
            renderPropertyList();
            
            if (loadingState) loadingState.style.display = 'none';
            if (propertyData.length > 0) {
                if (propertyList) propertyList.style.display = 'block';
            } else {
                if (emptyState) emptyState.style.display = 'block';
            }
        }
    } catch (error) {
        console.error('加载房源数据失败:', error);
        Utils.showToast('数据加载失败', 'error');
    }
}

// 更新房源统计
function updatePropertyStats() {
    const total = propertyData.length;
    const rent = propertyData.filter(p => p.type === '出租').length;
    const sale = propertyData.filter(p => p.type === '出售').length;
    const sold = propertyData.filter(p => p.status === '已成交').length;
    
    document.getElementById('totalProperties').textContent = total;
    document.getElementById('rentProperties').textContent = rent;
    document.getElementById('saleProperties').textContent = sale;
    document.getElementById('soldProperties').textContent = sold;
}

// 渲染房源列表
function renderPropertyList() {
    const container = document.getElementById('propertyList');
    if (!container) return;
    
    if (filteredProperties.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <div class="icon"><i class="fas fa-search"></i></div>
                <div class="title">没有找到匹配的房源</div>
                <div class="description">尝试调整筛选条件或搜索关键词</div>
            </div>
        `;
        return;
    }
    
    container.innerHTML = filteredProperties.map(property => createPropertyCard(property)).join('');
}

// 创建房源卡片
function createPropertyCard(property) {
    const statusClass = property.type === '出租' ? 'success' : 'primary';
    const priceText = property.type === '出租' ? `${property.price}元/㎡/月` : `${property.price}万`;
    
    return `
        <div class="list-item property-card" data-property-id="${property.id}">
            <div class="property-image">
                <img src="${property.image}" 
                     alt="${property.title}" 
                     data-responsive 
                     data-base-url="${property.image.split('?')[0]}"
                     data-sizes='{"xs":{"width":300,"height":200},"sm":{"width":400,"height":250},"md":{"width":500,"height":300}}'
                     loading="lazy"
                     onerror="this.src='https://via.placeholder.com/300x200?text=房源图片'">
                <div class="property-badge ${statusClass}">${property.type}</div>
            </div>
            
            <div class="property-content">
                <div class="list-item-title">${property.title}</div>
                <div class="list-item-subtitle">
                    <i class="fas fa-map-marker-alt mr-1"></i>
                    ${property.location}
                </div>
                
                <div class="property-details">
                    <div class="detail-item">
                        <i class="fas fa-money-bill-wave text-primary"></i>
                        ${priceText}
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-ruler-combined text-info"></i>
                        ${property.area}㎡
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-arrows-alt-v text-warning"></i>
                        ${property.height}米层高
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-weight text-secondary"></i>
                        ${property.load}kg/㎡
                    </div>
                </div>
                
                <div class="property-meta">
                    <div class="meta-info">
                        <i class="fas fa-eye mr-1"></i>
                        ${property.views}次浏览
                    </div>
                    <div class="status-badge ${statusClass}">
                        ${property.status || property.type}
                    </div>
                </div>
                
                <div class="list-item-actions">
                    <a href="detail.html?id=${property.id}" class="list-item-action primary">
                        <i class="fas fa-eye"></i>
                        详情
                    </a>
                    <a href="#" class="list-item-action" onclick="shareProperty(${property.id})">
                        <i class="fas fa-share"></i>
                        分享
                    </a>
                    <a href="edit.html?id=${property.id}" class="list-item-action success">
                        <i class="fas fa-edit"></i>
                        编辑
                    </a>
                </div>
            </div>
        </div>
    `;
}

// 按类型筛选
function filterByType(type) {
    currentFilter = type;
    
    const filterTabs = document.querySelectorAll('.filter-tab');
    filterTabs.forEach(tab => {
        tab.classList.remove('active');
        if (tab.dataset.type === type) {
            tab.classList.add('active');
        }
    });
    
    applyFilters();
}

// 搜索处理
function handleSearch(query) {
    searchQuery = query.toLowerCase();
    applyFilters();
}

// 应用筛选条件
function applyFilters() {
    filteredProperties = propertyData.filter(property => {
        const typeMatch = currentFilter === 'all' || 
            (currentFilter === 'rent' && property.type === '出租') ||
            (currentFilter === 'sale' && property.type === '出售') ||
            (currentFilter === 'sold' && property.status === '已成交');
        
        const searchMatch = !searchQuery || 
            property.title.toLowerCase().includes(searchQuery) ||
            property.location.toLowerCase().includes(searchQuery);
        
        return typeMatch && searchMatch;
    });
    
    renderPropertyList();
}

// 分享房源
function shareProperty(propertyId) {
    const shareUrl = `${window.location.origin}/pages/share/property.html?id=${propertyId}`;
    
    if (navigator.share) {
        navigator.share({
            title: '房源推荐',
            text: '推荐一个优质工业厂房',
            url: shareUrl
        });
    } else {
        navigator.clipboard.writeText(shareUrl).then(() => {
            Utils.showToast('分享链接已复制到剪贴板', 'success');
        });
    }
}

// 显示搜索模态框
function showSearchModal() {
    Utils.showToast('搜索功能开发中', 'info');
}

// 显示筛选模态框  
function showFilterModal() {
    Utils.showToast('高级筛选功能开发中', 'info');
}

// 打开图片生成器
function openImageGenerator() {
    window.open('image-generator.html', '_blank', 'width=1200,height=800,scrollbars=yes,resizable=yes');
}

// 页面初始化
document.addEventListener('DOMContentLoaded', function() {
    loadPropertyData();
});

// 导出函数供全局使用
window.filterByType = filterByType;
window.handleSearch = handleSearch;
window.shareProperty = shareProperty;
window.showSearchModal = showSearchModal;
window.showFilterModal = showFilterModal;
window.openImageGenerator = openImageGenerator;
    </script>
    
    <style>
.property-card {
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.property-image {
    position: relative;
    width: 100%;
    height: 200px;
    overflow: hidden;
}

.property-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.property-badge {
    position: absolute;
    top: 12px;
    left: 12px;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
    color: white;
}

.property-content {
    padding: 16px;
}

.property-details {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    margin: 12px 0;
}

.detail-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 14px;
    color: var(--text-secondary);
}

.detail-item i {
    width: 16px;
    font-size: 14px;
}

.property-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 12px 0;
    font-size: 12px;
}

.meta-info {
    color: var(--text-secondary);
}

@media (max-width: 576px) {
    .property-details {
        grid-template-columns: 1fr;
    }
}

.fab-group {
    position: fixed;
    bottom: 80px;
    right: var(--spacing-lg);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
    z-index: 100;
}

.fab {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    border: none;
    background: var(--primary-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    cursor: pointer;
    box-shadow: var(--shadow-lg);
    transition: all 0.3s ease;
}

.fab:hover {
    transform: scale(1.1);
    background: var(--primary-dark);
}

.fab.fab-secondary {
    background: linear-gradient(135deg, #667eea, #764ba2);
    width: 48px;
    height: 48px;
    font-size: 16px;
}

.fab.fab-secondary:hover {
    background: linear-gradient(135deg, #5a6fd8, #6a4190);
}
    </style>
</body>
</html>