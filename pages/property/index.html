<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ¿æºç®¡ç† - å·¥ä¸šåœ°äº§SCRM</title>
    <link rel="stylesheet" href="../../assets/css/global.css">
    <link rel="stylesheet" href="../../assets/css/components.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="page">
            <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
            <header class="navbar">
                <button class="navbar-back" onclick="Navigation.back()">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="navbar-title">æˆ¿æºç®¡ç†</div>
                <div class="navbar-actions">
                    <button class="navbar-action" onclick="openImageGenerator()">
                        <i class="fas fa-magic"></i>
                    </button>
                    <button class="navbar-action" onclick="showSearchModal()">
                        <i class="fas fa-search"></i>
                    </button>
                    <button class="navbar-action" onclick="showFilterModal()">
                        <i class="fas fa-filter"></i>
                    </button>
                </div>
            </header>

            <!-- æœç´¢æ  -->
            <div class="search-bar">
                <input type="text" class="search-input" placeholder="ğŸ” è¾“å…¥æˆ¿æºå…³é”®è¯..." id="searchInput" onInput="handleSearch(this.value)">
                <button class="search-filter" onclick="showFilterModal()">
                    ç­›é€‰ <i class="fas fa-cog"></i>
                </button>
            </div>

            <!-- ç­›é€‰æ ‡ç­¾æ  -->
            <div class="filter-tabs">
                <button class="filter-tab active" data-type="all" onclick="filterByType('all')">å…¨éƒ¨</button>
                <button class="filter-tab" data-type="rent" onclick="filterByType('rent')">å‡ºç§Ÿ</button>
                <button class="filter-tab" data-type="sale" onclick="filterByType('sale')">å‡ºå”®</button>
                <button class="filter-tab" data-type="sold" onclick="filterByType('sold')">å·²æˆäº¤</button>
            </div>

            <!-- é¡µé¢å†…å®¹ -->
            <main class="page-content">
                <!-- æˆ¿æºç»Ÿè®¡ -->
                <div class="stats-cards" style="grid-template-columns: repeat(4, 1fr); margin-bottom: 16px;">
                    <div class="stats-card">
                        <div class="number" id="totalProperties">0</div>
                        <div class="label">æ€»æˆ¿æº</div>
                    </div>
                    <div class="stats-card">
                        <div class="number" id="rentProperties">0</div>
                        <div class="label">å‡ºç§Ÿ</div>
                    </div>
                    <div class="stats-card">
                        <div class="number" id="saleProperties">0</div>
                        <div class="label">å‡ºå”®</div>
                    </div>
                    <div class="stats-card">
                        <div class="number" id="soldProperties">0</div>
                        <div class="label">å·²æˆäº¤</div>
                    </div>
                </div>

                <!-- æˆ¿æºåˆ—è¡¨ -->
                <div id="propertyList" class="property-list">
                    <!-- æˆ¿æºå¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>

                <!-- ç©ºçŠ¶æ€ -->
                <div id="emptyState" class="empty-state" style="display: none;">
                    <div class="icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="title">æš‚æ— æˆ¿æºæ•°æ®</div>
                    <div class="description">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å‘å¸ƒç¬¬ä¸€ä¸ªæˆ¿æº</div>
                    <button class="btn btn-primary" onclick="Navigation.goto('add.html')">
                        <i class="fas fa-plus"></i>
                        å‘å¸ƒæˆ¿æº
                    </button>
                </div>

                <!-- åŠ è½½çŠ¶æ€ -->
                <div id="loadingState" class="text-center p-4">
                    <div class="spinner" style="margin: 0 auto 16px;"></div>
                    <div class="text-secondary">åŠ è½½æˆ¿æºæ•°æ®ä¸­...</div>
                </div>
            </main>

            <!-- åº•éƒ¨å¯¼èˆªæ  -->
            <nav class="tabbar">
                <a href="../index.html" class="tabbar-item">
                    <div class="icon">
                        <i class="fas fa-home"></i>
                    </div>
                    é¦–é¡µ
                </a>
                <a href="../customer/index.html" class="tabbar-item">
                    <div class="icon">
                        <i class="fas fa-users"></i>
                    </div>
                    å®¢æˆ·
                </a>
                <a href="index.html" class="tabbar-item active">
                    <div class="icon">
                        <i class="fas fa-building"></i>
                    </div>
                    æˆ¿æº
                </a>
                <a href="../promotion/index.html" class="tabbar-item">
                    <div class="icon">
                        <i class="fas fa-share-alt"></i>
                    </div>
                    æ¨å¹¿
                </a>
                <a href="../profile/index.html" class="tabbar-item">
                    <div class="icon">
                        <i class="fas fa-user"></i>
                    </div>
                    æˆ‘çš„
                </a>
            </nav>
        </div>
    </div>

    <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
    <div class="fab-group">
        <button class="fab fab-secondary" onclick="openImageGenerator()" title="AIå›¾ç‰‡ç”Ÿæˆ">
            <i class="fas fa-magic"></i>
        </button>
        <button class="fab" onclick="Navigation.goto('add.html')" title="å‘å¸ƒæˆ¿æº">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <script src="../../assets/js/common.js"></script>
    <script>
// æˆ¿æºæ•°æ®
let propertyData = [];
let filteredProperties = [];
let currentFilter = 'all';

// åŠ è½½æˆ¿æºæ•°æ®
async function loadPropertyData() {
    try {
        const loadingState = document.getElementById('loadingState');
        const propertyList = document.getElementById('propertyList');
        const emptyState = document.getElementById('emptyState');
        
        if (loadingState) loadingState.style.display = 'block';
        if (propertyList) propertyList.style.display = 'none';
        if (emptyState) emptyState.style.display = 'none';
        
        // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
        const mockData = {
            success: true,
            data: [
                {
                    id: 1,
                    title: 'æ·±åœ³å®å®‰åŒºç°ä»£å·¥ä¸šå›­åŒº',
                    location: 'æ·±åœ³å¸‚å®å®‰åŒºçŸ³å²©è¡—é“',
                    type: 'å‡ºç§Ÿ',
                    status: 'å¯ç§Ÿ',
                    price: 80,
                    area: 3000,
                    height: 8,
                    load: 800,
                    views: 125,
                    image: 'https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=400&h=300&fit=crop'
                },
                {
                    id: 2,
                    title: 'å¹¿å·å¤©æ²³ç§‘æŠ€å›­å‚æˆ¿',
                    location: 'å¹¿å·å¸‚å¤©æ²³åŒºç§‘å­¦åŸ',
                    type: 'å‡ºç§Ÿ',
                    status: 'å¯ç§Ÿ',
                    price: 75,
                    area: 2500,
                    height: 6,
                    load: 600,
                    views: 98,
                    image: 'https://images.unsplash.com/photo-1565043666747-69f6646db940?w=400&h=300&fit=crop'
                },
                {
                    id: 3,
                    title: 'ä¸œèæ¾å±±æ¹–é«˜æ–°äº§ä¸šå›­',
                    location: 'ä¸œèå¸‚æ¾å±±æ¹–å›­åŒº',
                    type: 'å‡ºå”®',
                    status: 'åœ¨å”®',
                    price: 2800,
                    area: 5000,
                    height: 10,
                    load: 1000,
                    views: 156,
                    image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop'
                },
                {
                    id: 4,
                    title: 'ä½›å±±å—æµ·æ™ºèƒ½åˆ¶é€ åŸºåœ°',
                    location: 'ä½›å±±å¸‚å—æµ·åŒºæ¡‚åŸè¡—é“',
                    type: 'å‡ºç§Ÿ',
                    status: 'å¯ç§Ÿ',
                    price: 65,
                    area: 4200,
                    height: 9,
                    load: 900,
                    views: 87,
                    image: 'https://images.unsplash.com/photo-1541888946425-d81bb19240f5?w=400&h=300&fit=crop'
                },
                {
                    id: 5,
                    title: 'æƒ å·å¤§äºšæ¹¾çŸ³åŒ–å›­åŒº',
                    location: 'æƒ å·å¸‚å¤§äºšæ¹¾å¼€å‘åŒº',
                    type: 'å‡ºç§Ÿ',
                    status: 'å¯ç§Ÿ',
                    price: 55,
                    area: 6000,
                    height: 12,
                    load: 1200,
                    views: 142,
                    image: 'https://images.unsplash.com/photo-1504917595217-d4dc5ebe6122?w=400&h=300&fit=crop'
                },
                {
                    id: 6,
                    title: 'ä¸­å±±ç«ç‚¬å¼€å‘åŒºå‚æˆ¿',
                    location: 'ä¸­å±±å¸‚ç«ç‚¬å¼€å‘åŒº',
                    type: 'å‡ºå”®',
                    status: 'åœ¨å”®',
                    price: 1800,
                    area: 3500,
                    height: 7,
                    load: 700,
                    views: 73,
                    image: 'https://images.unsplash.com/photo-1497366216548-37526070297c?w=400&h=300&fit=crop'
                },
                {
                    id: 7,
                    title: 'ç æµ·æ¨ªç´è‡ªè´¸åŒºäº§ä¸šå›­',
                    location: 'ç æµ·å¸‚æ¨ªç´æ–°åŒº',
                    type: 'å‡ºç§Ÿ',
                    status: 'å·²æˆäº¤',
                    price: 120,
                    area: 2800,
                    height: 8,
                    load: 800,
                    views: 203,
                    image: 'https://images.unsplash.com/photo-1497366811353-6870744d04b2?w=400&h=300&fit=crop'
                },
                {
                    id: 8,
                    title: 'æ±Ÿé—¨è“¬æ±ŸåŒºæ™ºé€ å›­',
                    location: 'æ±Ÿé—¨å¸‚è“¬æ±ŸåŒº',
                    type: 'å‡ºç§Ÿ',
                    status: 'å¯ç§Ÿ',
                    price: 45,
                    area: 4800,
                    height: 6,
                    load: 600,
                    views: 64,
                    image: 'https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=400&h=300&fit=crop'
                }
            ]
        };
        
        if (mockData.success) {
            propertyData = mockData.data;
            filteredProperties = [...propertyData];
            
            updatePropertyStats();
            renderPropertyList();
            
            if (loadingState) loadingState.style.display = 'none';
            if (propertyData.length > 0) {
                if (propertyList) propertyList.style.display = 'block';
            } else {
                if (emptyState) emptyState.style.display = 'block';
            }
        }
    } catch (error) {
        console.error('åŠ è½½æˆ¿æºæ•°æ®å¤±è´¥:', error);
        Utils.showToast('æ•°æ®åŠ è½½å¤±è´¥', 'error');
    }
}

// æ›´æ–°æˆ¿æºç»Ÿè®¡
function updatePropertyStats() {
    const total = propertyData.length;
    const rent = propertyData.filter(p => p.type === 'å‡ºç§Ÿ').length;
    const sale = propertyData.filter(p => p.type === 'å‡ºå”®').length;
    const sold = propertyData.filter(p => p.status === 'å·²æˆäº¤').length;
    
    document.getElementById('totalProperties').textContent = total;
    document.getElementById('rentProperties').textContent = rent;
    document.getElementById('saleProperties').textContent = sale;
    document.getElementById('soldProperties').textContent = sold;
}

// æ¸²æŸ“æˆ¿æºåˆ—è¡¨
function renderPropertyList() {
    const container = document.getElementById('propertyList');
    if (!container) return;
    
    if (filteredProperties.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <div class="icon"><i class="fas fa-search"></i></div>
                <div class="title">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æˆ¿æº</div>
                <div class="description">å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶æˆ–æœç´¢å…³é”®è¯</div>
            </div>
        `;
        return;
    }
    
    container.innerHTML = filteredProperties.map(property => createPropertyCard(property)).join('');
}

// åˆ›å»ºæˆ¿æºå¡ç‰‡
function createPropertyCard(property) {
    const statusClass = property.type === 'å‡ºç§Ÿ' ? 'success' : 'primary';
    const priceText = property.type === 'å‡ºç§Ÿ' ? `${property.price}å…ƒ/ã¡/æœˆ` : `${property.price}ä¸‡`;
    
    return `
        <div class="list-item property-card" data-property-id="${property.id}">
            <div class="property-image">
                <img src="${property.image}" 
                     alt="${property.title}" 
                     data-responsive 
                     data-base-url="${property.image.split('?')[0]}"
                     data-sizes='{"xs":{"width":300,"height":200},"sm":{"width":400,"height":250},"md":{"width":500,"height":300}}'
                     loading="lazy"
                     onerror="this.src='https://via.placeholder.com/300x200?text=æˆ¿æºå›¾ç‰‡'">
                <div class="property-badge ${statusClass}">${property.type}</div>
            </div>
            
            <div class="property-content">
                <div class="list-item-title">${property.title}</div>
                <div class="list-item-subtitle">
                    <i class="fas fa-map-marker-alt mr-1"></i>
                    ${property.location}
                </div>
                
                <div class="property-details">
                    <div class="detail-item">
                        <i class="fas fa-money-bill-wave text-primary"></i>
                        ${priceText}
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-ruler-combined text-info"></i>
                        ${property.area}ã¡
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-arrows-alt-v text-warning"></i>
                        ${property.height}ç±³å±‚é«˜
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-weight text-secondary"></i>
                        ${property.load}kg/ã¡
                    </div>
                </div>
                
                <div class="property-meta">
                    <div class="meta-info">
                        <i class="fas fa-eye mr-1"></i>
                        ${property.views}æ¬¡æµè§ˆ
                    </div>
                    <div class="status-badge ${statusClass}">
                        ${property.status || property.type}
                    </div>
                </div>
                
                <div class="list-item-actions">
                    <a href="detail.html?id=${property.id}" class="list-item-action primary">
                        <i class="fas fa-eye"></i>
                        è¯¦æƒ…
                    </a>
                    <a href="#" class="list-item-action" onclick="shareProperty(${property.id})">
                        <i class="fas fa-share"></i>
                        åˆ†äº«
                    </a>
                    <a href="edit.html?id=${property.id}" class="list-item-action success">
                        <i class="fas fa-edit"></i>
                        ç¼–è¾‘
                    </a>
                </div>
            </div>
        </div>
    `;
}

// æŒ‰ç±»å‹ç­›é€‰
function filterByType(type) {
    currentFilter = type;
    
    const filterTabs = document.querySelectorAll('.filter-tab');
    filterTabs.forEach(tab => {
        tab.classList.remove('active');
        if (tab.dataset.type === type) {
            tab.classList.add('active');
        }
    });
    
    applyFilters();
}

// æœç´¢å¤„ç†
function handleSearch(query) {
    searchQuery = query.toLowerCase();
    applyFilters();
}

// åº”ç”¨ç­›é€‰æ¡ä»¶
function applyFilters() {
    filteredProperties = propertyData.filter(property => {
        const typeMatch = currentFilter === 'all' || 
            (currentFilter === 'rent' && property.type === 'å‡ºç§Ÿ') ||
            (currentFilter === 'sale' && property.type === 'å‡ºå”®') ||
            (currentFilter === 'sold' && property.status === 'å·²æˆäº¤');
        
        const searchMatch = !searchQuery || 
            property.title.toLowerCase().includes(searchQuery) ||
            property.location.toLowerCase().includes(searchQuery);
        
        return typeMatch && searchMatch;
    });
    
    renderPropertyList();
}

// åˆ†äº«æˆ¿æº
function shareProperty(propertyId) {
    const shareUrl = `${window.location.origin}/pages/share/property.html?id=${propertyId}`;
    
    if (navigator.share) {
        navigator.share({
            title: 'æˆ¿æºæ¨è',
            text: 'æ¨èä¸€ä¸ªä¼˜è´¨å·¥ä¸šå‚æˆ¿',
            url: shareUrl
        });
    } else {
        navigator.clipboard.writeText(shareUrl).then(() => {
            Utils.showToast('åˆ†äº«é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
        });
    }
}

// æ˜¾ç¤ºæœç´¢æ¨¡æ€æ¡†
function showSearchModal() {
    Utils.showToast('æœç´¢åŠŸèƒ½å¼€å‘ä¸­', 'info');
}

// æ˜¾ç¤ºç­›é€‰æ¨¡æ€æ¡†  
function showFilterModal() {
    Utils.showToast('é«˜çº§ç­›é€‰åŠŸèƒ½å¼€å‘ä¸­', 'info');
}

// æ‰“å¼€å›¾ç‰‡ç”Ÿæˆå™¨
function openImageGenerator() {
    window.open('image-generator.html', '_blank', 'width=1200,height=800,scrollbars=yes,resizable=yes');
}

// é¡µé¢åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    loadPropertyData();
});

// å¯¼å‡ºå‡½æ•°ä¾›å…¨å±€ä½¿ç”¨
window.filterByType = filterByType;
window.handleSearch = handleSearch;
window.shareProperty = shareProperty;
window.showSearchModal = showSearchModal;
window.showFilterModal = showFilterModal;
window.openImageGenerator = openImageGenerator;
    </script>
    
    <style>
.property-card {
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.property-image {
    position: relative;
    width: 100%;
    height: 200px;
    overflow: hidden;
}

.property-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.property-badge {
    position: absolute;
    top: 12px;
    left: 12px;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
    color: white;
}

.property-content {
    padding: 16px;
}

.property-details {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    margin: 12px 0;
}

.detail-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 14px;
    color: var(--text-secondary);
}

.detail-item i {
    width: 16px;
    font-size: 14px;
}

.property-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 12px 0;
    font-size: 12px;
}

.meta-info {
    color: var(--text-secondary);
}

@media (max-width: 576px) {
    .property-details {
        grid-template-columns: 1fr;
    }
}

.fab-group {
    position: fixed;
    bottom: 80px;
    right: var(--spacing-lg);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
    z-index: 100;
}

.fab {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    border: none;
    background: var(--primary-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    cursor: pointer;
    box-shadow: var(--shadow-lg);
    transition: all 0.3s ease;
}

.fab:hover {
    transform: scale(1.1);
    background: var(--primary-dark);
}

.fab.fab-secondary {
    background: linear-gradient(135deg, #667eea, #764ba2);
    width: 48px;
    height: 48px;
    font-size: 16px;
}

.fab.fab-secondary:hover {
    background: linear-gradient(135deg, #5a6fd8, #6a4190);
}
    </style>
</body>
</html>